language: common-lisp
sudo: false

install:
  - curl -L https://raw.githubusercontent.com/snmsts/roswell/release/scripts/install-for-ci.sh | sh

cache:
    directories:
        - $HOME/.roswell

script:
  - ros -s prove -e '(or (prove:run :travis-test-test) (uiop:quit -1))'

env:
    global:
        - secure: "vnOrHnk1skckzieDIudoPP9GytRMuQc798EO+UIW4b9mt32VjKDSUCmDS9XlYoZkeVb3zjqcdncDzzBVE/HBwxlJkk9YQoDB7wl6fJWHqQcUDislEsirvGGIg9liy+zWUDiA67AV9hQyh9QPF9GXkzTYMxKTf8zWu81xSi1T59kCa5KGAmfxGbJUJGexfTr/v8Eg1UvOWf5lpQ9QEQYvITtZzQvVeRU+8Cfc3aYcsykYyewdC4+ZJu03F2itICY6fa9hCw3URCrWq9IinzQDLpUQ0BffkQAL0qnSSNhmrXaULGNbf70B5bqaFqYM7A8zQKOvn5DVFm4YCKPiwUtgwXg7DTu2hUCkNKb4EOewLaq18PNv9czl9DOR+4+ux9iPXUyWWqlBjVPNIFEjvo7S76vUi6jkBKmM6Wb2Nqc46+0dB0ct47AtKjlRli3f4ajnODnqdLGal9e/0cNyBBuy5hLJFVPlNhbhK3Id1zd0EJP1ua0aBhtwY5hp1C2fk+va2QcXGwX/4gWtyGe7go4MZsLlZ5nsiTNLePhLDXTFaxiOb/3MTHh9OIdlTmVltx0zYKEBwy1g89aYHFd7vFI8AoVsIodW6YBa3nSFNwBeFXJY0RtgmKjwmO1A0Y1Mn9ssZNcwRP7DNB0XlWCbF2tZjHvliDV2CZ/Hg5KFO8qa+xM="
        - secure: "dpty7fSpkuGECksnW0hJ9b1g+g08rGIZD8y3NQSDqpYR+r80GnqWBDUJsTG/LWmETR8AwDPY1C5b52vZxR/jS6DiasNu3HPgWps2Ah0RIdFxTg5Dw2k8Kb4ZE7YcX0e5zGY3Pwohxmhvd/nU8TpvJ/UL61+U4nYK1aPU9WqfJOhnluQk00tlmm0+KdgqP6RB15PvxG8N1jC/PyzkEt6nX/d7QTlJKeMVrn6Pd1tfDQpHhJu8ksCkJbK+LrIkAs1oJ/jweMfierkSX9d80YRm0KTI1AKimQ66SV4It8pUC48JfoDMa3DVLJXV/LHY788JpVBKErzYs7XgpqAMtjlg2cs+Zjk0B28sYaRZc0BFebVHQtSe4Ee5rmTqeZzLGze8ZLGxHLkIMNDSk7E7H/XE1K8KIoPivoc0EsdBQtRn8P2B7uPCqxH8PlfhoiJ+2ecMYzHFeRqBk0b0jcMDkKWEOZoIMcbhmTPJLh0/W3BzbsbFyXWb1rHB0sGKrRgfGVA4TkErWnQcr0hb/rXwRS+eCEz1NQyVtvbzaZdarbAwOCPlh11KM+Fr+3xIlw28uN6jcOjy0kYqyiwwFsR1otm/HtmC05WzPlGoNpC7xY79N3KrIJNMmdzQOhrrFLQVlgysVSwb3vbnPFI8ySeroCxVTBKA6/GjbNZA9AjCzCWgpyo="
        - secure: "bSQ66Ou/zSBAuqhvyBT+S/yel+QSDFyFbsflMK0Yx/vOqk5DeT8CL+7/VOgQfKgRPSI/CgVMc8lm6qGHfGRp45OshH6IEAMFEl3urUHGXwH+KPyxHHUjx47FMjRYr+cfha4LRIpzUitedzmfau8M9v33GsS+uCnI46rduXRtkOHC3n+dQbNBuUGfmttST0vPD4Slz8JTi57zBV1pxQ5f5tnR2/oXZOVBcGmSYGDuGF+fI2xd1pHZa32jn/QPcZ+7VUTDGD2IOK4duBFVOlMYalyw5tsOAjf+kbsweOgBIEFt/uLJ+WlOQBPjZwqoWspzGJmUUn5KG/m0cWvprcEaRVW5XeIc3pZcERH/zi2aKBZjDo716L8MCgVgBMkXgKbNgRf/bbieZhXAnm+vp7cjRr2gUiDCmEAvV+dfi7eMm3/0mqa1Ip+aGAVz84xLfUil2ApFOmuyYD1dRJ53JhgPNJ1M2MUMXRwmqI/rMAidzkHtn17KDJzZPepi6Gv6viiEMRal5AnuwjgYJxaRF7ftNB0/tMd3BzF9EJDrZNIXEWJiEzG3BXSuXPT6UKI2rpixHM+Kv/o304GHpo5ZTwe7djdCZ8HrvlRdQB0v+KVl8nLMWELHTo4JPuV92nog0cLl1JF78vTwwn2i0cAGsG4BWRWby8M445MShtFJ6eKJLgQ="
        - secure: "nq/qhFB2lj0+JYe3kW164DPrJQrCBb/66OU1KXm/GaGZIv6NWAhyYuip1RCqOqDcfqCIONmjjIo6VKCMU90vVpZs2tZl3KQm/cCJ4Kf7BEb+JAxyQhcTIaXhY9vAvqD2Ur50E5ej+tsaeOIfJgIlm6iVkNgqRMUrK6vrWgQY8J3YAj1axUK6e4Yk68bOFq1xpSgks9q5xJLEyKk0+hbqYQcx6lkV34Z5FPd65UqDkb5hliJyEYcl2uWgoFa6vADAIWMpVT2GJWQNRnxzRU7xeeb/vIl+G0FGj0e6PZHV3+9ld/NPb4A0pQdUdpUDTiFLQbxJiKQ2hOI3QfqwAleaVkMvO10dBS326lqMuL3sIxA+xLepOY3eGmecrrab1P98pPizeMsgWBziuOdPNxYuYqFoM8nFXi5ou+JYjZPj/gy+6fk/z/rzHLGGxWIqKxdJEO7CO9ymrTDeJKWp+0tpQTTEuhXt2XkKNoHKBNa9oDYwQogu11rTcsfoJrEZ89I1Dn2jheAR2fxb7NPnn32fJZlrDf5vtsl3OxSAZ+weM1zKmObTcUuPxBQmJRJWJ77ohzEvsjOAH0a77Q8ILe9P63+1mS6s9lgXdPmV7Hr3uPPXBzOSTn3N9lQ1/YasWB2hpOb8PRiPiTJzY4FLRVDo+0AtPi5Eh5AbgJ/HND8J8MU="
        - secure: "l24HoUU60AiDKAR6PQehD61mAjwlZToEpIr0JXnDbbJL6+cekVInOWiT1hZVllQkzwivtq1vEJfxGyzgmcfOAEPi0SbIf1y36V0+BgSymD/0xDip/KULXvmU5+YsvMwlCBT0j7LoTsexnw8RY7o4Pzu1Je7hTWyygkQiZ0VM080RnziGd31oNOp6/xncxj9qIBYoCkBSHXBLbPI0Fn1Tc5eoR74WTG5xRMxS1VAjE+jZWqGmjMf3jB/u4xp0HUTw4jg4TLSM/BLIQYJ3p6fuMCRvEN9VR1td9OOn0zKvErjF1ct7GNldFo4y0wVu6P65yHGx9jHub64g/DMB8oGn6LCYiTuzBhuJi/DqastABker2rG/K0KqR5OcJtoofAKvCF8Gm6VtxbllvnxWb0GMZoauVZ7A3qxdWQw/kbQ4T3RL69l5vmgUkpzUslUHXELpy1KuZpV0c0by/DaSYFY1qIwqdWAFCpBoCcDnCK/1VCzHBJg7RKCu0OziXtjImZcJLcSE6Xu+XW0hkYu/Pswz9gotT1wbDh3rcR1sELHmPGMiSaMgBIA5eCrX+a3P38ktzoab5WZRM8INgk2dIJLsIWwBkILQ9IKpOT+vJpoZatiMCSlHQh1DhtGACvRlZs6fwU0TP21uxENlStMPt0gOWBe6uG4v0Y1UlfIyxQbv5vo="
        - PATH=~/.roswell/bin:$PATH
        - ROSWELL_INSTALL_DIR=$HOME/.roswell

addons:
    apt:
        packages:
            - sshpass

after_success:
    - if [[ "$TRAVIS_BRANCH" == "master" ]]; then
        export SSHPASS=$DEPLOY_PASS;
        echo $DEPLOY_PASS | sshpass -e ssh -p $DEPLOY_PORT -o "StrictHostKeyChecking"=no $DEPLOY_USER@$DEPLOY_HOST sudo -S $DEPLOY_PATH/deploy.sh 1>/dev/null 2>/dev/null;
      fi